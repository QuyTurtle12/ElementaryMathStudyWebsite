@page
@model ElementaryMathStudyWebsite.RazorPage.Pages.UserAnswerPages.IndexModel

@{
    ViewData["Title"] = "Index";
}

<h1>Index</h1>

<table class="table">
    <thead>
        <tr>
            <th>Question</th>
            <th>Option Answer</th>
            <th>Attempt Number</th>
            <th>User</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model.UserAnswers)
        {
            <tr>
                <td>
                    @{
                        // Transform the HTML content to plain text with bold formatting
                        string formattedQuestionContent = HtmlToPlainText(item.QuestionContent ?? "");
                    }
                    <span>@Html.Raw(formattedQuestionContent)</span>
                </td>
                <td>@item.OptionAnswer</td>
                <td>@item.AttemptNumber</td>
                <td>@item.UserFullName</td>
            </tr>
        }
    </tbody>
</table>

@functions {
    public string HtmlToPlainText(string htmlContent)
    {
        if (string.IsNullOrWhiteSpace(htmlContent))
            return string.Empty;

        // Decode HTML entities
        string plainText = System.Net.WebUtility.HtmlDecode(htmlContent);

        // Replace <p> and </p> with newlines
        plainText = plainText.Replace("<p>", "").Replace("</p>", "\n");

        // Apply bold formatting for text between *
        plainText = System.Text.RegularExpressions.Regex.Replace(
            plainText,
            @"\*(.*?)\*",
            "<b>$1</b>"
        );

        // Replace newlines with <br/> for proper HTML rendering
        plainText = plainText.Replace("\n", "<br/>");

        return plainText;
    }
}